import{e as R,a7 as V,a as w,f as k,h as l,o,k as i,U as d,s as p,a5 as T,X as m,W as _,j as U,V as j,_ as x,l as D,a8 as C}from"./vue-DTj65VEW.js";import{j as r,A as F,C as E,_ as N,D as $}from"./index-D_nuE6M8.js";const z=["id"],I={key:0,class:"loading"},S={key:1,class:"captcha-img-box"},X=["src","alt"],A=["onClick"],M={key:2,class:"captcha-prompt"},P={key:3,class:"captcha-prompt"},W={class:"captcha-refresh-box"},Y=["title"],q=R({__name:"index",props:{uuid:{default:""},callback:{type:Function,default:()=>{}},class:{default:""},unset:{type:Boolean,default:!1},error:{default:r.global.t("validate.The correct area is not clicked, please try again!")},success:{default:r.global.t("validate.Verification is successful!")},apiBaseURL:{default:""}},emits:["destroy"],setup(h,{emit:u}){V(e=>({a4be934c:L.value,"161e14a2":B.value,"3e60f39a":t.captcha.width,"1f52465a":t.captcha.height}));const a=h,t=w({loading:!0,xy:[],tip:"",captcha:{id:"",text:"",base64:"",width:350,height:200}}),f=u,g=()=>{t.loading=!0,F(a.uuid,a.apiBaseURL).then(e=>{t.xy=[],t.tip="",t.loading=!1,t.captcha=e.data})},v=e=>{if(t.xy.length<t.captcha.text.length&&(t.xy.push(e.offsetX+","+e.offsetY),t.xy.length==t.captcha.text.length)){const s=[t.xy.join("-"),e.target.width,e.target.height].join(";");E(a.uuid,s,a.unset,a.apiBaseURL).then(()=>{t.tip=a.success,setTimeout(()=>{var c;(c=a.callback)==null||c.call(a,s),y()},1500)}).catch(()=>{t.tip=a.error,setTimeout(()=>{g()},1500)})}},b=e=>{t.xy.splice(e,1)},y=()=>{f("destroy")},B=k(()=>(t.captcha.height+200)/2+"px"),L=k(()=>(t.captcha.width+24)/2+"px");return g(),(e,s)=>(o(),l("div",{id:e.uuid},[i("div",{class:x(["ba-click-captcha",a.class])},[t.loading?(o(),l("div",I,d(p(r).global.t("utils.Loading")),1)):(o(),l("div",S,[i("img",{class:"captcha-img",onClick:s[0]||(s[0]=T(c=>v(c),["prevent"])),src:t.captcha.base64,alt:p(r).global.t("validate.Captcha loading failed, please click refresh button")},null,8,X),(o(!0),l(m,null,_(t.xy,(c,n)=>(o(),l("span",{key:n,class:"step",onClick:H=>b(n),style:U(`left:${parseFloat(c.split(",")[0])-13}px;top:${parseFloat(c.split(",")[1])-13}px`)},d(n+1),13,A))),128))])),t.tip?(o(),l("div",M,d(t.tip),1)):(o(),l("div",P,[j(d(p(r).global.t("validate.Please click"))+" ",1),(o(!0),l(m,null,_(t.captcha.text,(c,n)=>(o(),l("span",{key:n,class:x(t.xy.length>n?"clicaptcha-clicked":"")},d(c),3))),128))])),i("div",W,[s[1]||(s[1]=i("div",{class:"captcha-refresh-line captcha-refresh-line-l"},null,-1)),i("i",{class:"fa fa-refresh captcha-refresh-btn",title:p(r).global.t("Refresh"),onClick:g},null,8,Y),s[2]||(s[2]=i("div",{class:"captcha-refresh-line captcha-refresh-line-r"},null,-1))])],2),i("div",{class:"ba-layout-shade",onClick:y})],8,z))}}),G=N(q,[["__scopeId","data-v-397077c0"]]),O=(h,u,a={})=>{const t=document.createElement("div"),f=D(G,{uuid:h,callback:u,...a,key:$(),onDestroy:()=>{C(null,t)}});C(f,t),document.body.appendChild(t.firstElementChild)};export{O as c};
